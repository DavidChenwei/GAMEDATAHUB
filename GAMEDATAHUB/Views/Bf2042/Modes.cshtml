@model GAMEDATAHUB.Models.BF2042Model.GameModeView

@{
    ViewBag.Title = "Game Modes";
}

<body>
    <div class="gdh-wrapper">
        <div class="gdh-container">
            <div class="gdh-content">
                <div class="container">
                    <div class="content">
                        @Html.Partial("_Bf2042LayOut")
                        <div class="site-container trn-grid trn-grid--vertical trn-grid--small" style="position: relative;">
                            <div class="trn-grid trn-grid--small gamemodes">
                                <div class="st st--expand-hide-mobile">
                                    <div class="st-header">
                                        <div class="st__item st-header__item st-header__item--sortable st__item--sticky st__item--wide" style="--st-base-width: 14rem;">
                                            <span class="label">Gamemode</span>
                                        </div>
                                        <div class="st__item st-header__item st-header__item--active st-header__item--sortable" style="--st-base-width: 5.5rem;">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon">
                                                <path d="m7 10 5 5 5-5z"></path>
                                            </svg>
                                            <span class="label">Wins</span>
                                        </div>
                                        <div class="st__item st-header__item st-header__item--sortable" style="--st-base-width: 8rem;">
                                            <span class="label">Win %</span>
                                        </div>
                                        <div class="st__item st-header__item st-header__item--sortable" style="--st-base-width: 7.5rem;">
                                            <span class="label">Kills</span>
                                        </div>
                                        <div class="st__item st-header__item st-header__item--sortable" style="--st-base-width: 7.5rem;">
                                            <span class="label">Kills/min</span>
                                        </div>
                                        <div class="st__item st-header__item st-header__item--sortable" style="--st-base-width: 8rem;">
                                            <span class="label">Playtime</span>
                                        </div>
                                        <div class="st__item st__item--expand st__item--expand-hide-mobile"></div>
                                    </div>
                                    <div class="st-content">
                                        <div class="st-content__category">
                                            @foreach (var mode in Model.GameModeViews)
                                            {
                                                <div class="st-content__item">

                                                    <div class="st__item st-content__item-value st__item--sticky st__item--wide" style="--st-base-width: 14rem;">
                                                        <div class="info">
                                                            <div class="value">@mode.GamemodeName</div>
                                                        </div>
                                                    </div>
                                                    @if (Model.MaxWins == mode.Wins)
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--active st-content__item-value--highlight" style="--st-base-width: 5.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.Wins.ToString()</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--active" style="--st-base-width: 5.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.Wins.ToString()</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    @if (Model.MaxWinPercent == mode.WinPercentD)
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--highlight" style="--st-base-width: 8rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.WinPercent</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="st__item st-content__item-value" style="--st-base-width: 8rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.WinPercent</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    @if (Model.MaxKills == mode.Kills)
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--highlight" style="--st-base-width: 7.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.Kills.ToString("N0")</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="st__item st-content__item-value" style="--st-base-width: 7.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.Kills.ToString("N0")</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    @if (Model.MaxKPM == mode.KPM)
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--highlight" style="--st-base-width: 7.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.KPM.ToString()</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="st__item st-content__item-value" style="--st-base-width: 7.5rem;">
                                                            <div class="info">
                                                                <div class="value">@mode.KPM.ToString()</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    @if (Model.MaxTime == mode.HoursPlayed)
                                                    {
                                                        <div class="st__item st-content__item-value st-content__item-value--highlight" style="--st-base-width: 8rem;">
                                                            <div class="info">
                                                                <div class="value">@(mode.HoursPlayed)H</div>
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="st__item st-content__item-value" style="--st-base-width: 8rem;">
                                                            <div class="info">
                                                                <div class="value">@(mode.HoursPlayed)H</div>
                                                            </div>
                                                        </div>
                                                    }

                                                    <div class="st__item st__item--expand st-content__item-expand st__item--expand-hide-mobile">
                                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 16" class="icon">
                                                            <path d="M2 12a2 2 0 1 1-2 2 2 2 0 0 1 2-2m0-6a2 2 0 1 1-2 2 2 2 0 0 1 2-2m0-6a2 2 0 1 1-2 2 2 2 0 0 1 2-2Z"></path>
                                                        </svg>
                                                    </div>
                                                </div>
                                                <div class="st-content__drawer" style="display: none;">
                                                    <div class="stat-dump">
                                                        <div class="category">
                                                            <div class="category__header">Combat</div>
                                                            <div class="category__stats">
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Assists</div>
                                                                    <div class="value">@mode.Assists.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Kills</div>
                                                                    <div class="value">@mode.Kills.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Kills/Min</div>
                                                                    <div class="value">@mode.KPM.ToString()</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Revives</div>
                                                                    <div class="value">@mode.Revives.ToString("N0")</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="category">
                                                            <div class="category__header">Game</div>
                                                            <div class="category__stats">
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Best Squad</div>
                                                                    <div class="value">@mode.BestSquad.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Matches Lost</div>
                                                                    <div class="value">@mode.Losses.ToString("N0")</div>
                                                                </div>
                                                                <div class=" category__stats-stat">
                                                                    <div class="label">Matches Played</div>
                                                                    <div class="value">@mode.Matches.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Matches Won</div>
                                                                    <div class="value">@mode.Wins.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">MVPs</div>
                                                                    <div class="value">@mode.Mvp.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Time Played</div>
                                                                    <div class="value">@(mode.HoursPlayed)H</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Win %</div>
                                                                    <div class="value">@mode.WinPercent</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="category">
                                                            <div class="category__header">Objective</div>
                                                            <div class="category__stats">
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Defended Objectives</div>
                                                                    <div class="value">@mode.ObjectivesDefended.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Defended Sectors</div>
                                                                    <div class="value">@mode.SectorDefend.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Objective Time</div>
                                                                    <div class="value">@(mode.ObjetiveTime/3600)H</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Objectives Armed</div>
                                                                    <div class="value">@mode.ObjectivesArmed.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Objectives Captured</div>
                                                                    <div class="value">@mode.objectivesCaptured.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Objectives Destroyed</div>
                                                                    <div class="value">@mode.ObjectivesDestroyed.ToString("N0")</div>
                                                                </div>
                                                                <div class="category__stats-stat">
                                                                    <div class="label">Objectives Disarmed</div>
                                                                    <div class="value">@mode.ObjectivesDisarmed.ToString("N0")</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

        document.addEventListener("DOMContentLoaded", function () {
            var headers = document.querySelectorAll('.st-header .st-header__item');
            var sortMethod = "Desc";

            headers.forEach(function (header, index) {
                header.addEventListener('click', function () {
                    //To control when header is active the color change to green
                    headers.forEach(function (innerItem) {
                        innerItem.classList.remove('st-header__item--active');
                    });
                    header.classList.add('st-header__item--active');

                    //To control highligh when header is active
                    var st_content__items = document.querySelectorAll(".st-content__item>.st-content__item-value");
                    st_content__items.forEach(function (st_item) {
                        st_item.classList.remove('st-content__item-value--active');
                    });
                    var selected_st_content__items = document.querySelectorAll(".st-content__item>.st-content__item-value:nth-child(" + (index + 1) + ")");
                    selected_st_content__items.forEach(function (st_item) {
                        if (!st_item.classList.contains('st-content__item-value--active')) {
                            st_item.classList.add('st-content__item-value--active');
                        }
                    });

                    //To control the svg when header is active
                    headers.forEach(function (header) {
                        if (header.classList.contains('st-header__item--active')) {
                            //Add the svg if the header is active
                            if (!header.querySelector('.st__item svg')) {
                                var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                                svg.setAttribute('class', 'icon');
                                svg.setAttribute('viewBox', '0 0 24 24');

                                var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                                path.setAttribute('d', 'm7 10 5 5 5-5z');
                                svg.appendChild(path);
                                var span = header.querySelector('.st__item span');
                                header.insertBefore(svg, span);
                            } else {
                                //Switch between Desc and Asce
                                var pathValue = header.querySelector('.st__item .icon path').getAttribute('d');
                                var d2 = "m7 10 5 5 5-5z";
                                var d1 = "m7 14 5-5 5 5z";
                                if (pathValue === d1) {
                                    header.querySelector('.st__item .icon path').setAttribute('d', d2);
                                    sortMethod = "Desc";
                                } else {
                                    header.querySelector('.st__item .icon path').setAttribute('d', d1);
                                    sortMethod = "Asce";
                                }
                            }
                        }
                        else {
                            var svg = header.querySelector('.st__item svg');
                            if (svg) {
                                header.removeChild(svg);
                            }
                        }
                    });

                    //Send the Ajax Post
                    var heroName = document.getElementById('HeroName').value;
                    var platForm = document.getElementById('PlatForm').value;
                    var headerName = header.querySelector('.label').textContent;
                    console.log(heroName);
                    console.log(platForm);
                    console.log(headerName);
                    $.ajax({
                        url: '@Url.Action("ModesUpdate", "Bf2042")',
                        type: 'POST',
                        data: {
                            HeaderName: headerName,
                            SortMethod: sortMethod,
                            HeroName: heroName,
                            PlatForm: platForm
                        },
                        success: function (response){
                            var parsedData = JSON.parse(response);
                            //console.log(parsedData);
                            let gameModeViews = parsedData.GameModeViews;
                            //Update the content item infomation
                            var contentItems = document.querySelectorAll('.st-content__category .st-content__item');
                            var JsonIndex = 0;
                            contentItems.forEach(function (item) {
                                var HeaderIndex = 0;
                                var st__items = item.querySelectorAll('.st__item');
                                st__items.forEach(function (st__item) {
                                    var child = st__item.querySelector('.info .value');
                                    if (HeaderIndex == 0) {
                                        child.innerText = gameModeViews[JsonIndex]['GamemodeName'];
                                    }
                                    if (HeaderIndex == 1) {
                                        child.innerText = gameModeViews[JsonIndex]['Wins'].toLocaleString('en-US');
                                        if (parsedData['MaxWins'] == gameModeViews[JsonIndex]['Wins']) {
                                            st__item.classList.add('st-content__item-value--highlight');
                                        } else {
                                            st__item.classList.remove('st-content__item-value--highlight');
                                        }
                                    }
                                    if (HeaderIndex == 2) {
                                        child.innerText = gameModeViews[JsonIndex]['WinPercent'].toLocaleString('en-US');
                                        if (parsedData['MaxWinPercent'] == gameModeViews[JsonIndex]['WinPercentD']) {
                                            st__item.classList.add('st-content__item-value--highlight');
                                        } else {
                                            st__item.classList.remove('st-content__item-value--highlight');
                                        }
                                    }
                                    if (HeaderIndex == 3) {
                                        child.innerText = gameModeViews[JsonIndex]['Kills'].toLocaleString('en-US');
                                        if (parsedData['MaxKills'] == gameModeViews[JsonIndex]['Kills']) {
                                            st__item.classList.add('st-content__item-value--highlight');
                                        } else {
                                            st__item.classList.remove('st-content__item-value--highlight');
                                        }
                                    }
                                    if (HeaderIndex == 4) {
                                        child.innerText = gameModeViews[JsonIndex]['KPM'].toLocaleString('en-US');
                                        if (parsedData['MaxKPM'] == gameModeViews[JsonIndex]['KPM']) {
                                            st__item.classList.add('st-content__item-value--highlight');
                                        } else {
                                            st__item.classList.remove('st-content__item-value--highlight');
                                        }
                                    }
                                    if (HeaderIndex == 5) {
                                        child.innerText = gameModeViews[JsonIndex]['HoursPlayed'].toLocaleString('en-US') + "H";
                                        if (parsedData['MaxTime'] == gameModeViews[JsonIndex]['HoursPlayed']) {
                                            st__item.classList.add('st-content__item-value--highlight');
                                        } else {
                                            st__item.classList.remove('st-content__item-value--highlight');
                                        }
                                    }
                                    HeaderIndex += 1;
                                });
                                JsonIndex += 1;
                            });
                            JsonIndex = 0;

                            //Update the content drawer
                            var drawertItems = document.querySelectorAll('.st-content__category .st-content__drawer');
                            drawertItems.forEach(function (drawer) {
                                var categoryItems = drawer.querySelectorAll('.category');
                                var categoryIndex = 0;
                                categoryItems.forEach(function (category) {

                                    if (categoryIndex == 0) {
                                        var stats = category.querySelectorAll('.category__stats-stat .value');
                                        var statIndex = 0;
                                        var id = category.querySelector('.category__header').innerText;
                                        stats.forEach(function (state) {
                                            if (statIndex == 0) {
                                                state.innerText = gameModeViews[JsonIndex]['Assists'].toLocaleString('en-US');
                                            }
                                            if (statIndex == 1) {
                                                state.innerText = gameModeViews[JsonIndex]['Kills'].toLocaleString('en-US');
                                            }
                                            if (statIndex == 2) {
                                                state.innerText = gameModeViews[JsonIndex]['KPM'].toLocaleString('en-US');
                                            }
                                            if (statIndex == 3) {
                                                state.innerText = gameModeViews[JsonIndex]['Revives'].toLocaleString('en-US');
                                            }
                                            statIndex += 1;
                                        });
                                    }
                                    if (categoryIndex == 1) {
                                            var stats = category.querySelectorAll('.category__stats-stat .value');
                                            var statIndex = 0;
                                            stats.forEach(function (state) {
                                                if (statIndex == 0) {
                                                    state.innerText = gameModeViews[JsonIndex]['BestSquad'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 1) {
                                                    state.innerText = gameModeViews[JsonIndex]['Losses'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 2) {
                                                    state.innerText = gameModeViews[JsonIndex]['Matches'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 3) {
                                                    state.innerText = gameModeViews[JsonIndex]['Wins'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 4) {
                                                    state.innerText = gameModeViews[JsonIndex]['Mvp'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 5) {
                                                    state.innerText = gameModeViews[JsonIndex]['HoursPlayed'].toLocaleString('en-US')+"H";
                                                }
                                                if (statIndex == 6) {
                                                    state.innerText = gameModeViews[JsonIndex]['WinPercent'].toLocaleString('en-US');
                                                }
                                                statIndex += 1;
                                            });
                                    }
                                    if (categoryIndex == 2) {
                                            var stats = category.querySelectorAll('.category__stats-stat .value');
                                            var statIndex = 0;
                                            stats.forEach(function (state) {
                                                if (statIndex == 0) {
                                                    state.innerText = gameModeViews[JsonIndex]['ObjectivesDefended'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 1) {
                                                    state.innerText = gameModeViews[JsonIndex]['SectorDefend'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 2) {
                                                    state.innerText = gameModeViews[JsonIndex]['ObjetiveHours'].toLocaleString('en-US') + "H";
                                                }
                                                if (statIndex == 3) {
                                                    state.innerText = gameModeViews[JsonIndex]['ObjectivesArmed'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 4) {
                                                    state.innerText = gameModeViews[JsonIndex]['objectivesCaptured'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 5) {
                                                    state.innerText = gameModeViews[JsonIndex]['ObjectivesDestroyed'].toLocaleString('en-US');
                                                }
                                                if (statIndex == 6) {
                                                    state.innerText = gameModeViews[JsonIndex]['ObjectivesDisarmed'].toLocaleString('en-US');
                                                }
                                                statIndex += 1;
                                            });
                                    }
                                    categoryIndex += 1;
                                });
                                JsonIndex += 1;
                            });
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(textStatus, errorThrown);
                        }
                    }
                    );
                });
            });

        });

        /*Control show more info*/
        document.addEventListener("DOMContentLoaded", function () {
            var expandElements = document.querySelectorAll(".st-content__category .st__item--expand");
            expandElements.forEach(function (expandElement, index) {
                expandElement.addEventListener("click", function () {
                    var expand = expandElements[index];
                    if (expand.classList.contains("st-content__item-expand--active")) {
                        expand.classList.remove("st-content__item-expand--active");
                    } else {
                        expand.classList.add("st-content__item-expand--active");
                    }
                    var drawer = document.querySelector(".st-content__category>.st-content__drawer:nth-child(" + (2 * (index + 1)) + ")");
                    drawer.style.display = (drawer.style.display === "none" || drawer.style.display === "") ? "block" : "none";
                });
            });
        });
    </script>
</body>